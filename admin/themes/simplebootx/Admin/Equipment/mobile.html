<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:U('Equipment/mobile')}">手机列表</a></li>
			<li><a href="{:U('Equipment/verfly')}">验证手机指令</a></li>
		</ul>
		<form class="well form-search" method="post" action="{:U('Equipment/mobile')}">
			分类： 
			<select class="select_2" name="cate_id">
				<option value='0'>全部</option>
				<foreach name="equiact" item="val">
					<option value="{$val.id}" <if condition="$val.id == $parameters['cate_id']">selected="selected"</if> >{$val.cate_name}</option>
				</foreach>
			</select> &nbsp;&nbsp;
			关键字： 
			<input type="text" name="keyword" style="width: 200px;" value="{$parameters.keyword}" placeholder="请输入序列号或别名">
			<input type="submit" class="btn btn-primary" value="搜索" />
		</form>
		<form class="js-ajax-form" action="{:U('Menu/listorders')}" method="post">			
			<table class="table table-hover table-bordered table-list" id="menus-table">
				<thead>
					<tr>
						<th width="80">{:L('SORT')}</th>
						<th width="50">ID</th>
						<th>序列号</th>		
						<th width="180">别名</th>								
						<th>微信个数</th>
						<th>设备分类</th>
						<th>执行指令</th>	
						<th width="80">发布人</th>	
						<!--<th width="80">{:L('STATUS')}</th>-->
						<th width="180">{:L('ACTIONS')}</th>
					</tr>
				</thead>
				<tbody>
					<volist name="list" id='vo'>
					<tr>					
						<td><input name="listorders[{$vo.id}]" type="text" size="3" value="{$vo.sort|default=0}" class="input input-order"></td>
						<td>{$vo.id}</td>
						<td>{$vo.cdkey}</td>
						<td><input type="text" class="alias" name="alias" value="{$vo.alias}" onchange="changealias(this,{$vo.id})"/></td>		
						<td>{$vo.numb}</td>
						<td>{$vo.cate_name}</td>
						<td><a href="{:U('Task/taskinfo',array('id'=>$vo['runcodeid']))}">{$aryi[$vo['runcodeid']]}</a></td>
						<!--<td>{$vo.status}</td>-->
						<td>{$vo.username}</td>	
						<td>
							<a href="javascript:;" data_url="{:U('Admin/Equipment/info',array('id'=>$vo['id']))}" onclick="open_dialog(this,{$vo['id']})">执行指令</a>
							<a href="{:U('Admin/Equipment/mobilecate',array('id'=>$vo['id']))}">设置设备分类</a>
						</td>
					</tr>
					</volist>
				</tbody>
				<tfoot>
					<tr>
						<th width="80">{:L('SORT')}</th>
						<th width="50">ID</th>
						<th>序列号</th>	
						<th width="180">别名</th>								
						<th>微信个数</th>
						<th>设备分类</th>
						<th>执行指令</th>
						<th>分布人</th>						
						<!--<th width="80">{:L('STATUS')}</th>-->
						<th width="180">{:L('ACTIONS')}</th>
					</tr>
				</tfoot>
			</table>	
			
		</form>
		<div class="page">
			{$page}
		</div>
		
		<div class="dialog" style="width:100%;height:100%;position:fixed;z-index:100px;top:30%;display:none;">
			<div class="dialog_con" style="width:600px;height:300px;margin:0 auto;background:#fff;border:1px #ddd solid;">
				<!--<iframe src="" style="width:100%;height:100%"></iframe>-->
				<div class="wrap">
					<ul class="nav nav-tabs">
						<li class="active"><a href="{:U('Equipment/mobile')}">执行指令</a></li>
					</ul>
					<form method="post" class="form-horizontal js-ajax-form" action="{:U('Equipment/info')}">
						<fieldset>
							<div class="control-group">
								<label class="control-label">指令</label>
								<div class="controls">
									<select name="runcode" id="rouncodelist">
										
									</select>
									<input type="hidden" id="info_id" name="id" value="{:I('id')}" />
								</div>
							</div>
						</fieldset>
						<div class="form-actions">
							<button type="submit" class="btn btn-primary js-ajax-submit">{:L('SAVE')}</button>
							<a class="btn" href="javascript:;" onclick="close_dialog();">取消</a>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		function close_dialog(){
			$('.dialog').hide();
		}
		function open_dialog(obj,id){
			var data_url = $(obj).attr('data_url');
			$('#info_id').val(id);
			$('.dialog').show();
			//$('.dialog iframe').attr('src',data_url);
			getruncode(id);
		}
		
		function getruncode(id){
			var data_url = "{:U('Equipment/getinfo')}";
			
			$.post(data_url,{id:id},function(data){
				var data = eval('('+data+')');
				var runcodeid = data['runcodeid'];
				var op_html = '';
				var list = data['list'];
				for(var i=0;i<list.length;i++){
					if(runcodeid == list[i]['id']){
						op_html = '<option value="'+list[i]['id']+'" selected="selected">'+list[i]['taskname']+'</option>';
					}else{
						op_html = '<option value="'+list[i]['id']+'">'+list[i]['taskname']+'</option>';
					}
					$('#rouncodelist').append(op_html);				
				}
			})
		}
		
	</script>
	<script>
		$(document).ready(function() {
			Wind.css('treeTable');
			Wind.use('treeTable', function() {
				$("#menus-table").treeTable({
					indent : 20
				});
			});
		});

		setInterval(function() {
			var refersh_time = getCookie('refersh_time_admin_menu_index');
			if (refersh_time == 1) {
				reloadPage(window);
			}
		}, 1000);
		setCookie('refersh_time_admin_menu_index', 0);
		
		function changealias(obj,id){
			var alias = $(obj).val();
			$.post("__URL__/savemobileajax",{id:id,alias:alias},function(data){
				if(data.result == 1){
					$(obj).val(alias);
				}else{
					alert('设置失败');
				}
			})
			
		}
	</script>
</body>
</html>